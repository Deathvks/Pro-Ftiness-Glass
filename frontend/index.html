<!doctype html>
<html lang="es">

<head>
  <meta charset="UTF-8" />

  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <meta http-equiv="Content-Security-Policy" content="
      default-src * 'self' 'unsafe-inline' 'unsafe-eval' data: gap: content: blob:;
      style-src * 'self' 'unsafe-inline';
      script-src * 'self' 'unsafe-inline' 'unsafe-eval' blob:;
      worker-src * 'self' blob:;
      img-src * 'self' data: blob:;
      media-src * 'self' data: blob:;
      frame-src * 'self' data: blob:;
      connect-src * 'self' 'unsafe-inline';
    " />

  <link rel="icon" type="image/png" href="/favicon-32x32.png" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=5" />

  <meta name="theme-color" content="#000000" />

  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="Pro Fitness Glass" />

  <title>Pro Fitness Glass - Tu App de Fitness</title>
  <meta name="description"
    content="Registra tus entrenamientos, sigue tu progreso nutricional y alcanza tus objetivos de fitness con Pro Fitness Glass." />
  <meta name="keywords"
    content="fitness, gym, entrenamiento, nutrición, rutinas, pesas, calorías, macros, salud, deporte, tracker" />

  <link rel="apple-touch-icon" href="/apple-touch-icon.webp">
  <meta name="google-site-verification" content="ARC8lM_i6d5sVoiyNVFvw28qpbyy-Xr7xI5eZBHmaSo" />

  <link rel="preconnect" href="https://accounts.google.com" />

  <meta property="og:type" content="website" />
  <meta property="og:title" content="Pro Fitness Glass - Tu App de Fitness" />
  <meta property="og:description" content="Entrena inteligente. Registra tus rutinas y nutrición fácilmente." />
  <meta property="og:image" content="/logo.webp" />
  <meta property="og:site_name" content="Pro Fitness Glass" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Pro Fitness Glass" />
  <meta name="twitter:description" content="Tu compañero definitivo de entrenamiento y nutrición." />
  <meta name="twitter:image" content="/logo.webp" />

  <style>
    :root {
      /* Fallback seguro inicial */
      --app-accent: #22c55e;
      
      /* Variables Glass con Fallback para navegadores antiguos */
      --splash-glass-bg: rgba(255, 255, 255, 0.1); 
      --splash-glass-border: rgba(255, 255, 255, 0.2);
      --splash-glass-highlight: rgba(255, 255, 255, 0.3);
    }

    /* Redefinición con color-mix si está soportado */
    @supports (background-color: color-mix(in srgb, red, blue)) {
      :root {
        --splash-glass-bg: color-mix(in srgb, var(--app-accent) 15%, rgba(255, 255, 255, 0.05));
        --splash-glass-border: color-mix(in srgb, var(--app-accent) 40%, rgba(255, 255, 255, 0.1));
        --splash-glass-highlight: rgba(255, 255, 255, 0.15);
      }
    }

    .app-splash-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 9999;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background-color: inherit; /* Hereda del body configurado por JS */
      color: #ffffff;
      opacity: 1;
      transition: opacity 0.3s ease;
    }

    .app-splash-spinner {
      width: 48px;
      height: 48px;
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      border-top-color: var(--app-accent);
      animation: spin 1s ease-in-out infinite;
      box-shadow: 0 0 20px -5px var(--app-accent);
      margin-top: 2rem;
    }

    html.light-theme .app-splash-screen {
      color: #0f172a;
    }

    html.light-theme .app-splash-spinner {
      border-color: rgba(0, 0, 0, 0.05);
      border-top-color: var(--app-accent);
    }

    .app-splash-title {
      font-size: 2.5rem;
      font-weight: 800;
      text-align: center;
      line-height: 1.2;
      letter-spacing: -0.02em;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;
      /* Animación de entrada */
      animation: fadeUp 0.8s ease-out forwards;
      opacity: 0; /* Empieza invisible y la animación lo muestra */
    }

    /* Badge GLASS */
    .app-splash-title span.glass-badge {
      display: inline-block;
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      padding: 0.5rem 1.5rem;
      border-radius: 1rem;
      
      background-color: var(--splash-glass-bg);
      border: 1px solid var(--splash-glass-border);
      border-top-color: var(--splash-glass-highlight);
      
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      
      box-shadow: 
        0 4px 6px -1px rgba(0, 0, 0, 0.1),
        0 2px 4px -1px rgba(0, 0, 0, 0.06),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
        
      color: var(--app-accent);
      text-transform: uppercase;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>

  <script>
    (function () {
      try {
        // 1. Recuperar Preferencias (Tema y Acento)
        var savedTheme = localStorage.getItem('theme') || 'system';
        var savedAccent = localStorage.getItem('accent') || '#22c55e';
        var systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (savedAccent.startsWith('"') && savedAccent.endsWith('"')) {
          savedAccent = savedAccent.slice(1, -1);
        }

        // 2. Variable CSS global inmediata
        document.documentElement.style.setProperty('--app-accent', savedAccent);

        // 3. Tema efectivo
        var effectiveTheme = savedTheme;
        if (effectiveTheme === 'system') {
          effectiveTheme = systemDark ? 'dark' : 'light';
        }

        // 4. Paleta
        var colors = {
          light: '#f7fafc',
          dark: '#0c111b',
          oled: '#000000'
        };
        var selectedColor = colors[effectiveTheme] || colors.dark;
        var statusBarStyle = effectiveTheme === 'light' ? 'default' : 'black-translucent';

        // 5. Clases y Background
        var root = document.documentElement;
        root.classList.remove('light-theme', 'dark-theme', 'oled-theme');

        if (savedTheme === 'system') {
          root.classList.add(systemDark ? 'dark-theme' : 'light-theme');
        } else {
          root.classList.add(effectiveTheme + '-theme');
        }

        // Sincronización crítica del fondo
        root.style.backgroundColor = selectedColor;
        
        // Aplicar al body apenas esté disponible
        var setBodyColor = function() {
            if(document.body) document.body.style.backgroundColor = selectedColor;
        };
        if(document.body) setBodyColor();
        else document.addEventListener('DOMContentLoaded', setBodyColor);

        // 6. Meta Tags
        var updateMeta = function(name, content) {
            var meta = document.querySelector('meta[name="' + name + '"]');
            if (!meta) {
                meta = document.createElement('meta');
                meta.name = name;
                document.head.appendChild(meta);
            }
            meta.content = content;
        };
        updateMeta("theme-color", selectedColor);
        updateMeta("apple-mobile-web-app-status-bar-style", statusBarStyle);

      } catch (e) {
        console.error('Splash init error', e);
      }
    })();
  </script>
</head>

<body>
  <div id="root">
    <div class="app-splash-screen">
      <div class="app-splash-title">
        PRO FITNESS 
        <span class="glass-badge">GLASS</span>
      </div>
      <div class="app-splash-spinner"></div>
    </div>
  </div>
  <script type="module" src="/src/main.jsx"></script>
</body>

</html>